{% extends 'base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="{% static 'css/pagamentos.css' %}">
<div class="payment-wrapper">
  <div class="payment-container">
    <h2><i class="fa-solid fa-credit-card me-2"></i>Editar Informações de Pagamento</h2>

    <form method="post" class="payment-form">
      {% csrf_token %}

      <div class="mb-3">
        <label for="id_metodo_pagamento" class="form-label">Método de Pagamento</label>
        {{ form.metodo_pagamento }}
      </div>

      <div id="cartaoFields">
        <div class="row">
          <div class="col-md-6">
            <label for="id_nome_titular" class="form-label">Nome do Titular</label>
            {{ form.nome_titular }}
          </div>
          <div class="col-md-6">
            <label for="id_bandeira" class="form-label">Bandeira</label>
            {{ form.bandeira }}
          </div>
        </div>

        <label for="id_numero_cartao" class="form-label">Número do Cartão</label>
        {{ form.numero_cartao }}

        <div class="row">
          <div class="col-md-6">
            <label for="id_validade" class="form-label">Validade (MM/AA)</label>
            {{ form.validade }}
          </div>
          <div class="col-md-6">
            <label for="id_codigo_seguranca" class="form-label">CVV</label>
            {{ form.codigo_seguranca }}
          </div>
        </div>
      </div>

      <div id="pixField" style="display:none;">
        <label for="id_chave_pix" class="form-label">Chave Pix</label>
        {{ form.chave_pix }}
      </div>

      <button type="submit" class="btn-modern">
        <i class="fa-solid fa-floppy-disk me-2"></i>Salvar
      </button>
    </form>

    <div class="text-center">
    <a class="dropdown-item ajax-link btn-voltar" href="{% url 'editar_perfil' %}" data-ajax="true">
    <i class="fas fa-edit"></i> ← Voltar ao Perfil</a>
    </div>
  </div>
</div>

<script>
/* Alterna exibição de campos conforme método de pagamento */
document.addEventListener("DOMContentLoaded", function () {
  const metodoSelect = document.getElementById("id_metodo_pagamento");
  const cartaoFields = document.getElementById("cartaoFields");
  const pixField = document.getElementById("pixField");

  function toggleFields() {
    const metodo = metodoSelect.value;
    if (metodo === "pix") {
      cartaoFields.style.display = "none";
      pixField.style.display = "block";
    } else {
      cartaoFields.style.display = "block";
      pixField.style.display = "none";
    }
  }

  metodoSelect.addEventListener("change", toggleFields);
  toggleFields();
});
</script>
{% endblock %}
